<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Gojo Pair Web - Admin/Public</title>
<style>
body { font-family: Arial; padding:20px; background:#f5f5f5; }
input, button { margin:5px 0; padding:8px; width:100%; max-width:300px; }
.gallery { display:flex; flex-wrap:wrap; gap:10px; margin-top:20px; }
.card { border:1px solid #ccc; padding:10px; width:220px; background:#fff; border-radius:5px; }
.card img { width:100%; height:auto; border-radius:3px; }
button { cursor:pointer; }
</style>
</head>
<body>

<h1>Admin Upload (Secret Key)</h1>
<div id="uploadDiv">
<input type="file" id="fileInput"><br>
<input type="text" id="nameInput" placeholder="Name"><br>
<input type="text" id="descInput" placeholder="Description"><br>
<input type="text" id="keyInput" placeholder="Secret Key"><br>
<button onclick="uploadFile()">Upload</button>
</div>

<h2>Gallery</h2>
<div class="gallery" id="gallery"></div>

<script>
async function uploadFile() {
  const file = document.getElementById("fileInput").files[0];
  const name = document.getElementById("nameInput").value;
  const description = document.getElementById("descInput").value;
  const key = document.getElementById("keyInput").value;

  if(!file || !key) return alert("File & Secret Key required");

  const formData = new FormData();
  formData.append("photo", file);
  formData.append("name", name);
  formData.append("description", description);

  const res = await fetch('/upload?key='+encodeURIComponent(key), {
    method:'POST',
    body:formData
  });
  const data = await res.json();
  if(data.success) {
    alert("Upload successful!");
    loadGallery();
  } else {
    alert(data.message || "Upload failed");
  }
}

async function deleteFile(filename) {
  const key = prompt("Enter Secret Key to delete:");
  if(!key) return;

  const res = await fetch('/delete?key='+encodeURIComponent(key)+'&file='+encodeURIComponent(filename), {
    method:'POST'
  });
  const data = await res.json();
  if(data.success){
    alert("File deleted!");
    loadGallery();
  } else {
    alert(data.message || "Delete failed");
  }
}

async function loadGallery() {
  const res = await fetch('/uploads/');
  const files = await res.json();
  const gallery = document.getElementById("gallery");
  gallery.innerHTML = "";
  files.forEach(f=>{
    const card = document.createElement("div");
    card.className="card";
    if(f.file.match(/\.(jpg|jpeg|png|gif)$/i)){
      card.innerHTML=`<img src="/uploads/${f.file}" alt="${f.name}"><h4>${f.name}</h4><p>${f.description}</p><button onclick="deleteFile('${f.file}')">Delete</button>`;
    } else {
      card.innerHTML=`<p><strong>${f.name}</strong></p><p>${f.description}</p><a href="/uploads/${f.file}" target="_blank">Download</a><br><button onclick="deleteFile('${f.file}')">Delete</button>`;
    }
    gallery.appendChild(card);
  });
}

// Initial load
loadGallery();
</script>

</body>
</html>
