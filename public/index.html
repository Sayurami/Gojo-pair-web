<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Gojo Pair Web - Admin</title>
  <style>
    body { font-family: Arial; padding: 20px; background: #f5f5f5; }
    input, button { margin: 5px 0; padding: 8px; width: 100%; max-width: 300px; }
    .gallery { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px; }
    .card { border: 1px solid #ccc; padding: 10px; width: 220px; background: #fff; border-radius: 5px; }
    .card img { width: 100%; height: auto; border-radius: 3px; }
    button { cursor: pointer; }
  </style>
</head>
<body>

<h1>Admin Login</h1>
<div id="loginDiv">
  <input type="text" id="username" placeholder="Username"><br>
  <input type="password" id="password" placeholder="Password"><br>
  <button onclick="login()">Login</button>
</div>

<div id="uploadDiv" style="display:none;">
  <h2>Upload File</h2>
  <input type="file" id="fileInput"><br>
  <input type="text" id="nameInput" placeholder="Name"><br>
  <input type="text" id="descInput" placeholder="Description"><br>
  <button onclick="uploadFile()">Upload</button>
</div>

<h2>Gallery</h2>
<div class="gallery" id="gallery"></div>

<script>
let token = "";

// Admin Login
async function login() {
  const username = document.getElementById("username").value;
  const password = document.getElementById("password").value;

  const res = await fetch('/login', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ username, password })
  });

  const data = await res.json();
  if (data.token) {
    token = data.token;
    alert("Login successful!");
    document.getElementById("loginDiv").style.display = "none";
    document.getElementById("uploadDiv").style.display = "block";
  } else {
    alert(data.error || "Login failed");
  }
}

// Upload File
async function uploadFile() {
  const file = document.getElementById("fileInput").files[0];
  const name = document.getElementById("nameInput").value;
  const description = document.getElementById("descInput").value;

  if (!file) return alert("Select a file!");

  const formData = new FormData();
  formData.append("photo", file);
  formData.append("name", name);
  formData.append("description", description);

  const res = await fetch('/upload', {
    method: 'POST',
    headers: { 'Authorization': 'Bearer ' + token },
    body: formData
  });

  const data = await res.json();
  if (data.success) {
    alert("Upload successful!");
    loadGallery();
  } else {
    alert(data.error || "Upload failed");
  }
}

// Delete File
async function deleteFile(filename) {
  if(!confirm("Are you sure you want to delete this file?")) return;

  const res = await fetch('/uploads/' + filename, {
    method: 'DELETE',
    headers: { 'Authorization': 'Bearer ' + token }
  });

  const data = await res.json();
  if(data.success){
    alert("File deleted!");
    loadGallery();
  } else {
    alert(data.error || "Delete failed");
  }
}

// Load Gallery
async function loadGallery() {
  const res = await fetch('/uploads/');
  const files = await res.json();
  const gallery = document.getElementById("gallery");
  gallery.innerHTML = "";
  files.forEach(f => {
    const card = document.createElement("div");
    card.className = "card";
    if(f.file.match(/\.(jpg|jpeg|png|gif)$/i)){
      card.innerHTML = `
        <img src="/uploads/${f.file}" alt="${f.name}">
        <h4>${f.name}</h4>
        <p>${f.description}</p>
        <button onclick="deleteFile('${f.file}')">Delete</button>
      `;
    } else {
      card.innerHTML = `
        <p><strong>${f.name}</strong></p>
        <p>${f.description}</p>
        <a href="/uploads/${f.file}" target="_blank">Download</a>
        <br><button onclick="deleteFile('${f.file}')">Delete</button>
      `;
    }
    gallery.appendChild(card);
  });
}

// Initial load
loadGallery();
</script>

</body>
</html>
