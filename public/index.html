<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gojo Gallery</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
    h1 { text-align: center; }
    .login, .upload, .gallery { max-width: 600px; margin: 20px auto; padding: 15px; background: #fff; border-radius: 8px; box-shadow: 0 2px 6px rgba(0,0,0,0.2);}
    input, button, textarea { width: 100%; padding: 8px; margin: 5px 0; border-radius: 4px; border: 1px solid #ccc; }
    .gallery-item { display: inline-block; margin: 10px; text-align: center; vertical-align: top; }
    .gallery-item img { width: 150px; height: auto; border-radius: 4px; display: block; }
    a.mega-link { display: block; margin-top: 5px; font-size: 12px; color: blue; text-decoration: underline; }
  </style>
</head>
<body>

<h1>Gojo Gallery</h1>

<div class="login">
  <h2>Admin Login</h2>
  <input type="text" id="username" placeholder="Username">
  <input type="password" id="password" placeholder="Password">
  <button onclick="login()">Login</button>
</div>

<div class="upload" style="display:none;">
  <h2>Upload Photo</h2>
  <input type="text" id="photoName" placeholder="Photo Name">
  <textarea id="photoDesc" placeholder="Description"></textarea>
  <input type="file" id="photoFile">
  <button onclick="uploadPhoto()">Upload</button>
</div>

<div class="gallery">
  <h2>Gallery</h2>
  <div id="galleryItems"></div>
</div>

<script>
let token = '';

// ===== Admin Login =====
async function login() {
  const username = document.getElementById('username').value;
  const password = document.getElementById('password').value;
  const res = await fetch('/login', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ username, password })
  });
  const data = await res.json();
  if (data.token) {
    token = data.token;
    alert('Login successful ✅');
    document.querySelector('.upload').style.display = 'block';
  } else {
    alert('Login failed ❌');
  }
}

// ===== Upload Photo =====
async function uploadPhoto() {
  const file = document.getElementById('photoFile').files[0];
  const name = document.getElementById('photoName').value;
  const description = document.getElementById('photoDesc').value;
  if (!file) { alert('Select a photo!'); return; }

  const formData = new FormData();
  formData.append('photo', file);
  formData.append('name', name);
  formData.append('description', description);

  const res = await fetch('/upload', {
    method: 'POST',
    headers: { 'Authorization': 'Bearer ' + token },
    body: formData
  });
  const data = await res.json();
  if (data.success) {
    alert('Photo uploaded ✅');
    loadGallery();
  } else {
    alert('Upload failed ❌');
  }
}

// ===== Load Gallery =====
async function loadGallery() {
  const res = await fetch('/uploads');
  const photos = await res.json();
  const gallery = document.getElementById('galleryItems');
  gallery.innerHTML = '';
  photos.forEach(p => {
    const div = document.createElement('div');
    div.className = 'gallery-item';
    div.innerHTML = `
      <img src="/uploads/${p.file}" alt="${p.name}">
      <strong>${p.name}</strong>
      <p>${p.description}</p>
      ${p.megaLink ? `<a class="mega-link" href="${p.megaLink}" target="_blank">Download from MEGA</a>` : ''}
    `;
    gallery.appendChild(div);
  });
}

// Initial load
loadGallery();
</script>

</body>
</html>
