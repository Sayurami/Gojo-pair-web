<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Gallery + Admin Upload</title>
<style>
body { font-family: Arial; padding: 20px; }
input, button { margin: 5px; }
img { max-width: 150px; margin: 5px; }
</style>
</head>
<body>
<h2>Admin Login</h2>
<input id="username" placeholder="Username">
<input id="password" type="password" placeholder="Password">
<button onclick="login()">Login</button>

<h2>Upload</h2>
<div id="uploadSection" style="display:none;">
<input id="name" placeholder="Name">
<input id="description" placeholder="Description">
<input id="link" placeholder="Link (optional)">
<input type="file" id="photo">
<button onclick="uploadFile()">Upload</button>
</div>

<h2>Gallery</h2>
<div id="gallery"></div>

<script>
let token = '';

function login() {
  fetch('/login', {
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({
      username: document.getElementById('username').value,
      password: document.getElementById('password').value
    })
  }).then(r=>r.json()).then(d=>{
    if(d.token){ token = d.token; document.getElementById('uploadSection').style.display='block'; alert('Login success'); }
    else alert('Login failed');
  })
}

function uploadFile() {
  const fileInput = document.getElementById('photo');
  const formData = new FormData();
  formData.append('photo', fileInput.files[0]);
  formData.append('name', document.getElementById('name').value);
  formData.append('description', document.getElementById('description').value);
  formData.append('link', document.getElementById('link').value);

  fetch('/upload', {
    method:'POST',
    headers:{ 'Authorization':'Bearer '+token },
    body: formData
  }).then(r=>r.json()).then(d=>{
    if(d.success){ alert('Uploaded'); loadGallery(); }
    else alert('Upload failed');
  })
}

function loadGallery() {
  fetch('/uploads/').then(r=>r.json()).then(files=>{
    const gallery = document.getElementById('gallery');
    gallery.innerHTML='';
    files.forEach(f=>{
      gallery.innerHTML+=`
      <div>
        <b>${f.name}</b><br>
        <img src="/uploads/${f.file}"><br>
        ${f.description}<br>
        ${f.link?'<a href="'+f.link+'" target="_blank">Link</a>':''}<br>
        <a href="/download/${f.file}">Download</a> | 
        <a href="/zoom/${f.file}" target="_blank">Zoom</a> | 
        <button onclick="deleteFile('${f.file}')">Delete</button>
      </div>`;
    });
  });
}

function deleteFile(file){
  if(!token){ alert('Login first'); return; }
  fetch('/uploads/'+file, { method:'DELETE', headers:{'Authorization':'Bearer '+token} })
  .then(r=>r.json()).then(d=>{
    if(d.success) loadGallery();
    else alert('Delete failed');
  });
}

loadGallery();
</script>
</body>
</html>
