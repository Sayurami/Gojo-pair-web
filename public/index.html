<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Gojo Photo Upload</title>
  <style>
    body { font-family: Arial; max-width: 800px; margin: auto; padding: 20px; }
    .gallery { display: flex; flex-wrap: wrap; gap: 10px; }
    .gallery img { width: 150px; height: 150px; object-fit: cover; }
    input, button { margin: 5px 0; padding: 5px; }
  </style>
</head>
<body>
  <h1>Gojo Photo Upload</h1>

  <h2>Login (Admin)</h2>
  <input type="text" id="username" placeholder="Username" />
  <input type="password" id="password" placeholder="Password" />
  <button onclick="login()">Login</button>

  <h2>Upload Photo (Admin)</h2>
  <input type="file" id="photo" />
  <input type="text" id="name" placeholder="Photo Name" />
  <input type="text" id="description" placeholder="Photo Description" />
  <button onclick="upload()">Upload</button>

  <h2>Gallery</h2>
  <div class="gallery" id="gallery"></div>

  <script>
    let token = '';

    async function login() {
      const res = await fetch('/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          username: document.getElementById('username').value,
          password: document.getElementById('password').value
        })
      });
      const data = await res.json();
      if (data.token) { token = data.token; alert('Logged in!'); }
      else alert(data.error || 'Login failed');
    }

    async function upload() {
      if (!token) return alert('Login first!');
      const formData = new FormData();
      formData.append('photo', document.getElementById('photo').files[0]);
      formData.append('name', document.getElementById('name').value);
      formData.append('description', document.getElementById('description').value);

      const res = await fetch('/upload', {
        method: 'POST',
        headers: { 'Authorization': 'Bearer ' + token },
        body: formData
      });
      const data = await res.json();
      alert(data.success ? 'Uploaded!' : 'Upload failed');
      loadGallery();
    }

    async function loadGallery() {
      const res = await fetch('/uploads/');
      const photos = await res.json();
      const gallery = document.getElementById('gallery');
      gallery.innerHTML = '';
      photos.forEach(p => {
        const div = document.createElement('div');
        const img = document.createElement('img');
        img.src = p.file ? '/uploads/' + p.file : '';
        div.appendChild(img);
        if (token) {
          const del = document.createElement('button');
          del.textContent = 'Delete';
          del.onclick = async () => {
            await fetch('/uploads/' + p.file, {
              method: 'DELETE',
              headers: { 'Authorization': 'Bearer ' + token }
            });
            loadGallery();
          };
          div.appendChild(del);
        }
        gallery.appendChild(div);
      });
    }

    loadGallery();
  </script>
</body>
</html>
