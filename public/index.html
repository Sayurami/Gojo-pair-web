<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gojo Upload & Gallery</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; }
  .hidden { display: none; }
  .gallery { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px; }
  .gallery img { width: 150px; height: auto; border: 1px solid #ccc; padding: 5px; }
  input, button { margin: 5px 0; padding: 8px; width: 100%; max-width: 300px; }
  .item { border: 1px solid #ddd; padding: 10px; width: 150px; text-align: center; }
</style>
</head>
<body>

<h1>Gojo Upload & Gallery</h1>

<div id="loginDiv">
  <h2>Admin Login</h2>
  <input type="text" id="username" placeholder="Username">
  <input type="password" id="password" placeholder="Password">
  <button onclick="login()">Login</button>
  <p id="loginMsg" style="color:red;"></p>
</div>

<div id="uploadDiv" class="hidden">
  <h2>Upload File</h2>
  <input type="text" id="name" placeholder="File Name">
  <input type="text" id="description" placeholder="Description">
  <input type="file" id="photo">
  <button onclick="uploadFile()">Upload</button>
  <p id="uploadMsg" style="color:green;"></p>
  <button onclick="logout()">Logout</button>
</div>

<h2>Gallery</h2>
<div class="gallery" id="gallery"></div>

<script>
let token = '';

async function login() {
  const username = document.getElementById('username').value;
  const password = document.getElementById('password').value;
  const res = await fetch('/login', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ username, password })
  });
  const data = await res.json();
  if(data.token){
    token = data.token;
    document.getElementById('loginDiv').classList.add('hidden');
    document.getElementById('uploadDiv').classList.remove('hidden');
    document.getElementById('loginMsg').innerText = '';
  } else {
    document.getElementById('loginMsg').innerText = data.error || 'Login failed';
  }
}

function logout() {
  token = '';
  document.getElementById('loginDiv').classList.remove('hidden');
  document.getElementById('uploadDiv').classList.add('hidden');
}

async function uploadFile() {
  const name = document.getElementById('name').value;
  const description = document.getElementById('description').value;
  const photo = document.getElementById('photo').files[0];
  if(!photo) return alert('Select a file');

  const formData = new FormData();
  formData.append('photo', photo);
  formData.append('name', name);
  formData.append('description', description);

  const res = await fetch('/upload', {
    method: 'POST',
    headers: { 'Authorization': 'Bearer ' + token },
    body: formData
  });

  const data = await res.json();
  if(data.success){
    document.getElementById('uploadMsg').innerText = 'Upload successful!';
    loadGallery();
  } else {
    document.getElementById('uploadMsg').innerText = 'Upload failed!';
  }
}

async function loadGallery() {
  const res = await fetch('/uploads/');
  const files = await res.json();
  const gallery = document.getElementById('gallery');
  gallery.innerHTML = '';
  files.forEach(f => {
    const div = document.createElement('div');
    div.className = 'item';
    div.innerHTML = `
      <img src="/uploads/${f.file}" alt="${f.name}">
      <p><b>${f.name}</b></p>
      <p>${f.description}</p>
    `;
    gallery.appendChild(div);
  });
}

// initial load
loadGallery();
</script>

</body>
</html>
