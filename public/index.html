<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ðŸ”¥ Gojo Photo Gallery</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap');

  body {
    font-family: 'Poppins', sans-serif;
    margin: 0;
    padding: 20px;
    text-align: center;
    background: linear-gradient(-45deg, #ff4c00, #ff8a00, #ff1a00, #ff5733);
    background-size: 400% 400%;
    animation: gradientBG 15s ease infinite;
    color: #fff;
  }
  @keyframes gradientBG {0% {background-position:0% 50%;} 50% {background-position:100% 50%;} 100% {background-position:0% 50%;}}
  h1 { font-size: 2.8rem; margin: 20px 0; color:#fff; text-shadow:0 0 10px #fff,0 0 20px #ff4c00,0 0 30px #ff8a00;}

  form, #loginDiv {
    background: rgba(0,0,0,0.5);
    padding: 20px; border-radius:20px; backdrop-filter: blur(8px);
    display: flex; flex-direction: column; align-items: center; gap: 15px;
    max-width: 400px; margin: 0 auto 30px auto;
  }

  input, textarea, button { width: 100%; padding:12px; border-radius:12px; border:none; outline:none; font-size:1rem;}
  input, textarea { background: rgba(255,255,255,0.1); color: #fff; backdrop-filter: blur(4px);}
  button { background: linear-gradient(45deg,#ff4c00,#ff8a00); color:#fff; cursor:pointer; font-weight:600; transition:all 0.3s ease;}
  button:hover { transform: scale(1.05); box-shadow:0 0 20px #ff4c00,0 0 40px #ff8a00; }

  .gallery { display:flex; flex-wrap:wrap; justify-content:center; gap:25px; margin-top:30px; }
  .gallery-item { background: rgba(0,0,0,0.5); border-radius:20px; overflow:hidden; width:220px; transition: transform 0.3s, box-shadow 0.3s;}
  .gallery-item:hover { transform: translateY(-5px); box-shadow:0 0 25px #ff4c00,0 0 50px #ff8a00; }
  .gallery-item img { width:100%; height:150px; object-fit:cover; cursor:pointer; transition: transform 0.3s;}
  .gallery-item img:hover { transform: scale(1.1); }
  .gallery-item h3 { margin:10px 0 5px 0; font-size:1.2rem; color:#ffb347; }
  .gallery-item p { margin:0 10px 10px 10px; font-size:0.9rem; color:#fff; word-break:break-word; }
  .gallery-item a { color:#ff8a00; text-decoration:underline; }
  .gallery-item button { margin:5px; padding:5px 12px; border:none; border-radius:8px; cursor:pointer; font-weight:bold; color:#fff; background:linear-gradient(45deg,#ff4c00,#ff8a00); transition:0.3s;}
  .gallery-item button:hover { transform: scale(1.05); box-shadow:0 0 10px #ff4c00,0 0 20px #ff8a00;}
</style>
</head>
<body>

<h1>ðŸ”¥ Gojo Photo Gallery ðŸ”¥</h1>

<!-- Admin Login -->
<div id="loginDiv">
  <input type="text" id="username" placeholder="Username" />
  <input type="password" id="password" placeholder="Password" />
  <button onclick="loginAdmin()">Login</button>
</div>

<!-- Upload form -->
<form id="uploadForm" enctype="multipart/form-data" style="display:none;">
  <input type="file" name="photo" accept="image/*" required />
  <input type="text" name="name" placeholder="Photo Name" required />
  <textarea name="description" placeholder="Photo Description (support links)" rows="2" required></textarea>
  <button type="submit">Upload ðŸ”¥</button>
</form>

<div class="gallery" id="gallery"></div>

<script>
let token = '';

async function loginAdmin(){
  const username = document.getElementById('username').value;
  const password = document.getElementById('password').value;
  const res = await fetch('/login', {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({username,password})});
  const data = await res.json();
  if(data.token){
    token = data.token;
    alert('Login Successful!');
    document.getElementById('loginDiv').style.display = 'none';
    document.getElementById('uploadForm').style.display = 'flex';
  } else {
    alert(data.error || 'Login Failed');
  }
}

function linkify(text){return text.replace(/(https?:\/\/[^\s]+)/g,url=>`<a href="${url}" target="_blank">${url}</a>`);}

async function loadGallery(){
  const res = await fetch('/uploads/');
  const items = await res.json();
  const gallery = document.getElementById('gallery');
  gallery.innerHTML='';
  items.forEach(item=>{
    const div = document.createElement('div'); div.className='gallery-item';
    div.innerHTML=`
      <img src="/uploads/${item.file}" onclick="window.open('/uploads/${item.file}','_blank')" />
      <h3>${item.name}</h3>
      <p>${linkify(item.description)}</p>
      ${token?`<button onclick="downloadPhoto('/uploads/${item.file}')">Download</button>
      <button onclick="deletePhoto('${item.file}')">Delete</button>`:'<button onclick="downloadPhoto(\'/uploads/'+item.file+'\')">Download</button>'}
    `;
    gallery.appendChild(div);
  });
}

function downloadPhoto(url){
  const link = document.createElement('a'); link.href=url; link.download=url.split('/').pop(); document.body.appendChild(link); link.click(); document.body.removeChild(link);
}

async function deletePhoto(fileName){
  if(!token){ alert('Login required to delete'); return; }
  if(!confirm('Are you sure you want to delete this photo?')) return;
  const res = await fetch('/uploads/'+fileName,{method:'DELETE', headers:{'Authorization':'Bearer '+token}});
  const data = await res.json();
  if(data.success) loadGallery();
  else alert('Delete failed');
}

// Upload submit
const form = document.getElementById('uploadForm');
form.addEventListener('submit', async e=>{
  e.preventDefault();
  const formData = new FormData(form);
  const res = await fetch('/upload',{method:'POST', headers:{'Authorization':'Bearer '+token}, body:formData});
  const data = await res.json();
  if(data.success){ await loadGallery(); form.reset(); } else alert('Upload failed');
});

loadGallery();
</script>

</body>
</html>
